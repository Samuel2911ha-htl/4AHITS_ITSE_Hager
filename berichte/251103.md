# 4AHITS ITSE G1 (03.11.2025) Port Scan
---

- Klasse: 4AHITS
- Name: Samuel Hager
- Fach: ITSE
- Datum: 3.11.2025

## Übung (port probing)
Beim port probing möchte man herausfinden ob auf einem gewissen port ein Dienst läuft, welcher Dienst dies ist und (wenn möglich) mehr Details wie z.B. Versionsnummern. Diese Information dient als Basis für weitere Angriffe.

`telnet`, `nc` (netcat) und `curl` sind einfache Tools die zum port probing verwendet werden können. Teilweise ist es auch möglich die kontaktierten Dienste dazu zu veranlassen mehr Informationen über sich preiszugeben (banner grabbing).

- Verwende `telnet` um festzustellen ob ein ssh Server auf Metasploitable läuft
- Finde Bezeichnung und die Versionsnummer des Web Servers auf Metasploitable heraus. Auf 3 Arten:
  - Verwende `telnet`
  - Verwende `nc` (netcat)
    - Hinweis: der notwendige http request header kann am besten mit Hilfe eines Shell here-documents   beschrieben werden.
    - Verwende `curl`
- Erstelle ein port probing cheat sheet für alle 3 Tools

Den `telnet` Befehl verwendet man wie folgt:
![](berichte/Images/telnetssh.png)

Hinter die IP des Zielrechners folgt noch der Port 22, dieser steht für ssh. Wenn die Meldung dann ein `Trying` und `Connected` enthält, dann ist ssh aktiv.

Gleiches funkioniert natürlich mit einer anderen Portnummer für den Web Server. Dieser läuft auf Port 80. Zusätzlich benötigt man dann noch den kurzen Text `GET / HTTP/1.0`. Mit diesem Request Header kommuniziert man exlpiziet über HTTP und gibt die Version an.
Die Ausgabe sieht dann wie folgt aus:
```sh
┌──(kali㉿kali)-[~]
└─$ telnet 192.168.9.52 80                      
Trying 192.168.9.52...
Connected to 192.168.9.52.
Escape character is '^]'.
GET / HTTP/1.0

HTTP/1.1 200 OK
Date: Mon, 13 Oct 2025 11:50:08 GMT
Server: Apache/2.2.8 (Ubuntu) DAV/2
X-Powered-By: PHP/5.2.4-2ubuntu5.10
Content-Length: 891
Connection: close
Content-Type: text/html

<html><head><title>Metasploitable2 - Linux</title></head><body>
<pre>

                _                  _       _ _        _     _      ____  
 _ __ ___   ___| |_ __ _ ___ _ __ | | ___ (_) |_ __ _| |__ | | ___|___ \ 
| '_ ` _ \ / _ \ __/ _` / __| '_ \| |/ _ \| | __/ _` | '_ \| |/ _ \ __) |
| | | | | |  __/ || (_| \__ \ |_) | | (_) | | || (_| | |_) | |  __// __/ 
|_| |_| |_|\___|\__\__,_|___/ .__/|_|\___/|_|\__\__,_|_.__/|_|\___|_____|
                            |_|                                          


Warning: Never expose this VM to an untrusted network!

Contact: msfdev[at]metasploit.com

Login with msfadmin/msfadmin to get started


</pre>
<ul>
<li><a href="/twiki/">TWiki</a></li>
<li><a href="/phpMyAdmin/">phpMyAdmin</a></li>
<li><a href="/mutillidae/">Mutillidae</a></li>
<li><a href="/dvwa/">DVWA</a></li>
<li><a href="/dav/">WebDAV</a></li>
</ul>
</body>
</html>

Connection closed by foreign host.
```
Mit `netcat` muss man mit einer Pipe arbeiten um den Request Header zuerst mit einem `printf` zu übergeben.
```sh
┌──(kali㉿kali)-[~]
└─$ printf 'HEAD / HTTP/1.0\r\nHost: 192.168.9.52\r\n\r\n' | nc 192.168.9.52 80   
HTTP/1.1 200 OK
Date: Mon, 13 Oct 2025 12:03:52 GMT
Server: Apache/2.2.8 (Ubuntu) DAV/2
X-Powered-By: PHP/5.2.4-2ubuntu5.10
Connection: close
Content-Type: text/html
```

Für `curl` funktioniert das ganze ein wenig leichter, ganz ohne Header:
```sh
┌──(kali㉿kali)-[~]
└─$ curl -I 192.168.9.52                
HTTP/1.1 200 OK
Date: Mon, 13 Oct 2025 11:57:27 GMT
Server: Apache/2.2.8 (Ubuntu) DAV/2
X-Powered-By: PHP/5.2.4-2ubuntu5.10
Content-Type: text/html
```


#### Cheatsheet für Port Probing:

**Telnet**: Header nach Eingabe
```sh
$ telnet 192.168.9.52 80
GET / HTTP/1.0
```
**Netcat**: Header vor der Eingabe mit `printf`
```s
$ printf 'HEAD / HTTP/1.0\r\nHost: 192.168.9.52\r\n\r\n' | nc 192.168.9.52 80
```
**Curl**: Ohne Header, Option `-I`
```sh
$ curl -I 192.168.9.52
```

Für die Recherche wurde KI verwendet mir Prompts wie: `Testen des ssh Diensts über telnet`, `Wie findet man Bezeichnung und Version eines webservers raus über telnet`.

## Übung (netcat port scan)
Ermittle mit Hilfe von netcat welche Ports zwischen 1 und 30 in der Metasploitable VM geöffnet sind – Hinweis: dies geht in einer einzigen Kommandozeile. Recherchiere welche Dienste sich dort befinden.

Randnotitz: netcat wird auch gerne als das swiss army knife of network tools bezeichnet.

Mit der Option `-zv` und der Angabe `1-30`am Schluss bekommt man eine Übersicht der offenen Ports. `-z` ist für eine schnelle Ausgabe da, diese schließt die Ports nämlich direkt wieder nach dem öffnen und `-v` gibt eine detailierte Meldung in der Console aus.
```sh
┌──(kali㉿kali)-[~]
└─$ netcat -zv 192.168.9.52 1-30
192.168.9.52: inverse host lookup failed: Unknown host
(UNKNOWN) [192.168.9.52] 25 (smtp) open
(UNKNOWN) [192.168.9.52] 23 (telnet) open
(UNKNOWN) [192.168.9.52] 22 (ssh) open
(UNKNOWN) [192.168.9.52] 21 (ftp) open
```

## Übung (nmap port scan)
Nach dem ping scan (und wenn nicht die Option `-sn` angegeben ist) führt `nmap` automatisch einen port scan auf allen gefundenen hosts aus. Dabei wird versucht alle offenen Ports eines Hosts zu finden. Das Ziel ist eine Liste der am Host laufenden Dienste zu erhalten.

Hinweise: Man kann eine einzelne IP Adresse angeben, dann wird nur diese gescannt, z.B.: `nmap 192.168.178.42`

Siehe List of TCP and UDP port numbers

Aufgaben:

- Führe einen port scan auf die Metasploitable VM durch. Analysiere das Ergebnis.

- Experimentiere mit den Optionen für (Victim ist Metasploitable VM):
   -Scannen aller möglichen Ports. Macht das bei Metasploitable, verglichen zum Default Verhalten, einen Unterschied?
   -Überspringen Ping-Scan/Host-Discovery. Warum kann diese Option notwendig sein?
  - Service/Version Detection
  - OS Erkennung
  - Aggressive Scan
  - Timing/Speed
  - Ausgabe in Dateien
  - die Option --reason
  - nur die N häufigsten Ports scannen (dokumentiere den Geschwindigkeitsgewinn)
- Führe weitere port scans durch, auf:
  - einem Kali Linux auf einem anderen Rechner
  - einem Windows System
  - dem Default Gateway im Labor Netz
- Was kann alles mit einem port scan herausgefunden werden? Dokumentiere!

Die `nmap` Ausgabe gibt eine Liste einiger Ports aus die offen sind, nebendran mit einer Bezeichnung. Zusätzlich kann man noch rauslesen, dass 977 Ports gerschlossen sind. 
```sh
──(kali㉿kali)-[~]
└─$ nmap 192.168.9.52           
Starting Nmap 7.95 ( https://nmap.org ) at 2025-11-03 07:16 EST
Nmap scan report for 192.168.9.52
Host is up (0.0038s latency).
Not shown: 977 closed tcp ports (reset)
PORT     STATE SERVICE
21/tcp   open  ftp
22/tcp   open  ssh
23/tcp   open  telnet
25/tcp   open  smtp
53/tcp   open  domain
80/tcp   open  http
111/tcp  open  rpcbind
139/tcp  open  netbios-ssn
445/tcp  open  microsoft-ds
512/tcp  open  exec
513/tcp  open  login
514/tcp  open  shell
1099/tcp open  rmiregistry
1524/tcp open  ingreslock
2049/tcp open  nfs
2121/tcp open  ccproxy-ftp
3306/tcp open  mysql
5432/tcp open  postgresql
5900/tcp open  vnc
6000/tcp open  X11
6667/tcp open  irc
8009/tcp open  ajp13
8180/tcp open  unknown
MAC Address: 00:0C:29:25:AA:6B (VMware)

Nmap done: 1 IP address (1 host up) scanned in 0.35 seconds
```
